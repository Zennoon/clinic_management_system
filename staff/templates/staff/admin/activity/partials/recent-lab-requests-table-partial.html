{% load humanize %}
<div id="recent-lab-requests-table-container" class="card flex flex-col gap-4">
    {% if recent_lab_requests %}
        <div class="flex items-center justify-between px-4 py-3 sm:px-6">
            <div class="flex flex-1 justify-between sm:hidden">
                {% if recent_lab_requests.has_previous %}
                    <button
                        class="relative inline-flex disabled:bg-gray-400 items-center rounded-md border px-4 py-2 text-sm font-medium"
                        hx-get="{% url 'staff:admin_activity_recent_lab_requests' %}?page={{ recent_lab_requests.previous_page_number }}"
                        hx-target="#recent-lab-requests-table-container"
                        hx-include="#recent-lab-requests-filters"
                    >
                        Previous
                    </button>
                {% else %}
                    <button
                        class="relative inline-flex disabled:bg-gray-400 items-center rounded-md border px-4 py-2 text-sm font-medium"
                        disabled
                    >
                        Previous
                    </button>
                {% endif %}
                {% if recent_lab_requests.has_next %}
                    <button
                        class="relative inline-flex disabled:bg-gray-400 items-center rounded-md border px-4 py-2 text-sm font-medium"
                        hx-get="{% url 'staff:admin_activity_recent_lab_requests' %}?page={{ recent_lab_requests.next_page_number }}"
                        hx-target="#recent-lab-requests-table-container"
                        hx-include="#recent-lab-requests-filters"
                    >
                        Next
                    </button>
                {% else %}
                    <button
                        class="relative inline-flex disabled:bg-gray-400 items-center rounded-md border px-4 py-2 text-sm font-medium"
                        disabled
                    >
                        Next
                    </button>
                {% endif %}
            </div>
            <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between border-b pb-4">
                <div>
                    <p class="text-sm">
                        Showing
                        <span class="font-medium">{{ recent_lab_requests.start_index }}</span>
                        to
                        <span class="font-medium">{{ recent_lab_requests.end_index }}</span>
                        of
                        <span class="font-medium">{{ recent_lab_requests.paginator.count }}</span>
                        results
                    </p>
                </div>
                <div>
                    <nav aria-label="Pagination" class="isolate inline-flex gap-1 rounded-md">
                        {% if recent_lab_requests.has_previous %}
                            <button
                                class="relative hover:bg-gray-200 disabled:bg-gray-200 transition-colors inline-flex items-center rounded-l-md px-2 py-2 inset-ring inset-ring-gray-700 focus:z-20 focus:outline-offset-0"
                                hx-get="{% url 'staff:admin_activity_recent_lab_requests' %}?page=1"
                                hx-target="#recent-lab-requests-table-container"
                                hx-include="#recent-lab-requests-filters"
                            >
                                <span class="sr-only">First Page</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-left-icon lucide-chevrons-left">
                                    <path d="m11 17-5-5 5-5"/><path d="m18 17-5-5 5-5"/>
                                </svg>
                            </button>
                        {% else %}
                            <button
                                class="relative hover:bg-gray-200 disabled:bg-gray-200 transition-colors inline-flex items-center rounded-l-md px-2 py-2 inset-ring inset-ring-gray-700 focus:z-20 focus:outline-offset-0"
                                disabled
                            >
                                <span class="sr-only">First Page</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-left-icon lucide-chevrons-left">
                                    <path d="m11 17-5-5 5-5"/><path d="m18 17-5-5 5-5"/>
                                </svg>
                            </button>
                        {% endif %}
                        {% if recent_lab_requests.has_previous %}
                            <button
                                class="relative hover:bg-gray-200 disabled:bg-gray-200 transition-colors inline-flex items-center rounded-md px-2 py-2 inset-ring inset-ring-gray-700 focus:z-20 focus:outline-offset-0"
                                hx-get="{% url 'staff:admin_activity_recent_lab_requests' %}?page={{ recent_lab_requests.previous_page_number }}"
                                hx-target="#recent-lab-requests-table-container"
                                hx-include="#recent-lab-requests-filters"
                            >
                                <span class="sr-only">Previous</span>
                                <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
                                    <path d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" fill-rule="evenodd" />
                                </svg>
                            </button>
                        {% else %}
                            <button
                                class="relative hover:bg-gray-200 disabled:bg-gray-200 transition-colors inline-flex items-center rounded-md px-2 py-2 inset-ring inset-ring-gray-700 focus:z-20 focus:outline-offset-0"
                                disabled
                            >
                                <span class="sr-only">Previous</span>
                                <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
                                    <path d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" fill-rule="evenodd" />
                                </svg>
                            </button>
                        {% endif %}
                        <!-- Current: "z-10 text-white focus-visible:outline-2 focus-visible:outline-offset-2 bg-indigo-500 focus-visible:outline-indigo-500", Default: "inset-ring focus:outline-offset-0 inset-ring-gray-700" -->
                        <span aria-current="page" class="relative transition-colors z-10 inline-flex items-center bg-indigo-500 px-4 py-2 text-sm font-semibold text-white rounded-md focus:z-20 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500">{{ recent_lab_requests.number }}</span>
                        {% if recent_lab_requests.has_next %}
                            <button
                                class="relative hover:bg-gray-200 disabled:bg-gray-200 transition-colors inline-flex items-center rounded-md px-2 py-2 inset-ring inset-ring-gray-700 focus:z-20 focus:outline-offset-0"
                                hx-get="{% url 'staff:admin_activity_recent_lab_requests' %}?page={{ recent_lab_requests.next_page_number }}"
                                hx-target="#recent-lab-requests-table-container"
                                hx-include="#recent-lab-requests-filters"
                            >
                                <span class="sr-only">Next</span>
                                <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
                                    <path d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
                                </svg>
                            </button>
                        {% else %}
                            <button
                                class="relative hover:bg-gray-200 disabled:bg-gray-200 transition-colors inline-flex items-center rounded-md px-2 py-2 inset-ring inset-ring-gray-700 focus:z-20 focus:outline-offset-0"
                                disabled
                            >
                                <span class="sr-only">Next</span>
                                <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
                                    <path d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
                                </svg>
                            </button>
                        {% endif %}
                        {% if recent_lab_requests.has_next %}
                            <button
                                class="relative hover:bg-gray-200 disabled:bg-gray-200 transition-colors inline-flex items-center rounded-r-md px-2 py-2 inset-ring inset-ring-gray-700 focus:z-20 focus:outline-offset-0"
                                hx-get="{% url 'staff:admin_activity_recent_lab_requests' %}?page={{ recent_lab_requests.paginator.num_pages }}"
                                hx-target="#recent-lab-requests-table-container"
                                hx-include="#recent-lab-requests-filters"
                            >
                                <span class="sr-only">Last Page</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-right-icon lucide-chevrons-right">
                                    <path d="m6 17 5-5-5-5"/><path d="m13 17 5-5-5-5"/>
                                </svg>
                            </button>
                        {% else %}
                            <button
                                class="relative hover:bg-gray-200 disabled:bg-gray-200 transition-colors inline-flex items-center rounded-r-md px-2 py-2 inset-ring inset-ring-gray-700 focus:z-20 focus:outline-offset-0"
                                disabled
                            >
                                <span class="sr-only">Last Page</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-right-icon lucide-chevrons-right">
                                    <path d="m6 17 5-5-5-5"/><path d="m13 17 5-5-5-5"/>
                                </svg>
                            </button>
                        {% endif %}
                    </nav>
                </div>
            </div>
        </div>
        <table class="table table-zebra table-pin-rows p-2 max-h-full overflow-scroll">
            <thead>
                <tr>
                    <th>Request ID</th>
                    <th>Patient ID</th>
                    <th>Patient Name</th>
                    <th>Ordered By</th>
                    <th>Tests</th>
                    <th>Visit ID</th>
                    <th>Total Price</th>
                    <th>Ordered At</th>
                </tr>
            </thead>
            <tbody>
                {% for req in recent_lab_requests %}
                    <tr>
                        <td>{{ req.id }}</td>
                        <td>{{ req.visit.patient.id }}</td>
                        <td>{{ req.visit.patient.fullname }}</td>
                        <td>{{ req.ordered_by.username }}</td>
                        <td>
                            
                            {% if req.tests.count > 0 %}
                                
                                {% with req.tests.all|first as test %}
                                    {{ test.lab_test.name }}
                                {% endwith %}
                                
                                {% if req.tests.count > 1   %}
                                    , ...
                                {% endif %}
                            {% else %}
                                No tests.
                            {% endif %}     
                        </td>
                        <td>{{ req.visit.id }}</td>
                        <td>{{ req.price|default_if_none:0|floatformat:2 }}</td>
                        <td>{{ req.created_at|date:"M d, Y" }}</td>
                    </tr>                    
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="flex items-center justify-center p-4">
            No Lab Requests found.
        </div>
    {% endif %}
</div>